@using AssemblyLine.ApplicationLayer.DTO
@inject IDeleteOperationUseCase _deleteOperationUseCase
@inject IJSRuntime _JSRuntime;


@foreach (var op in Operations)
{
    <tr class=""></tr>
    <tr class=" ">

        <td class=""></td>
        <td class="">@op.OrderInWhichToPerform</td>
        <td class="">@op.Name</td>
        <td class="">@op.DeviceName</td>
        <td class="">@op.DeviceType</td>
        <td class="cell">
            <button class="delete-button" @onclick="() => DeleteOperation(op.OperationId, op.Name)">
                <i class="fa-solid fa-trash icon"></i>
            </button>


            <button @onclick="() => ShowAddDeviceModal(op.AssemblyId, op.OperationId)" class="btn-device d-flex align-items-center justify-content-center gap-3">
                <i class="fa-solid fa-plus add-icon"></i>
                <span>Add Device</span>
            </button>

        </td>


    </tr>
}


@if (_showAddDeviceModalWindow == true)
{
    <AddDeviceModalComponent assemblyId="@assemblyId" operationId="@operationId" ParentMethodToCallOnClickBtnClose="() => _showAddDeviceModalWindow = false"></AddDeviceModalComponent>
}

@code {
    [Parameter]
    public List<OperationResponse> Operations { get; set; } = new List<OperationResponse>();
    [Parameter]
    public EventCallback Refresh { get; set; }


    private string confirmMessage = "Are you sure you want to delete the operation \"{0}\"?";
    private bool ConfirmResult { get; set; }
    private bool _showAddDeviceModalWindow = false;

    public int assemblyId { get; set; } = 0;
    public int operationId { get; set; } = 0;


    private void ShowAddDeviceModal(int assemblyIdSelected, int operationIdSelected)
    {
        assemblyId = assemblyIdSelected;
        operationId = operationIdSelected;
        _showAddDeviceModalWindow = !_showAddDeviceModalWindow;
        StateHasChanged();
    }

    protected async Task DeleteOperation(int operationId, string operationName)
    {
        ConfirmResult = await _JSRuntime.InvokeAsync<bool>("confirm", string.Format(confirmMessage, operationName)); // type

        if (ConfirmResult)
        {

            await _deleteOperationUseCase.ExecuteAsync(operationId);
            await Refresh.InvokeAsync(); // Refreshing the list

        }
        else
        {
            return;
        }


    }
}
